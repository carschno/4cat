<div class="post-annotations hidden">
	
	{% if annotation_fields %}
		{% set old_annotations = None %}
		{% if annotations and post.id in annotations %}
			{% set old_annotations = annotations[post.id] %}
		{% endif %}

		{% for field in annotation_fields %}

			{% set type = annotation_fields[field]["type"] %}
			{% set label = annotation_fields[field]["label"] %}
			{% set old_annotation = "" %}
			{% if old_annotations and label in old_annotations %}
				{% set old_annotation = old_annotations[label] %}
			{% endif %}
			
			<div class="post-annotation field-{{ field }} {{ type }}"><label class="annotation-label">{{ label }}</label>
			{% if type == 'text' %}
				<input type="text" class="post-annotation-input text-{{ field }}" value="{{ old_annotation }}">

			{% elif type == 'textarea' %}
				<textarea class="post-annotation-input textarea-{{ field }}">{{ old_annotation }}</textarea>

			{% elif type == 'dropdown' %}
				<select class="post-annotation-options select-{{ type }}" id="{{ field }}">
				<option class='post-annotation-input' value=''></option>

				{% for option in annotation_fields[field]["options"] %}
					{% set option_id = option.keys() | first %}
					{% set option_label = option.values() | first %}
					<option class="post-annotation-input option-{{ option_id }}" id="option-{{ option_id }}" value="{{ option_label }}" {% if option_label == old_annotation %}selected{% endif %}>{{ option_label }}</option>
				{% endfor %}
				</select>

			{% elif type == 'checkbox' %}
				<div class='post-annotation-options checkboxes-{{ field }}'>
				{% for option in annotation_fields[field]["options"] %}
					{% set option_id = option.keys() | first %}
					{% set option_label = option.values() | first %}
					{% set checked = "checked" if old_annotation and option_label in old_annotation else "" %}

					<input type='checkbox' class='post-annotation-input option-{{ option_id }}' id='option-{{ post.id }}-{{ option_id }}' value='{{ option_label }}' {{ checked }}><label for='option-{{ post.id }}-{{ option_id }}'>{{ option_label }}</label>
				{% endfor %}
				</div>
			{% endif %}

			</div>
		{% endfor %}
	{% endif %}
</div>