<div class="post-annotations">
	
	{% if annotation_fields %}
		{% if annotations and post.id in annotations %}
			{% set post_annotations = annotations[post.id] %}
		{% endif %}

		{% for field in annotation_fields %}

            {% set type = annotation_fields[field]["type"] %}
			{% set label = annotation_fields[field]["label"] %}

            {% set annotation = {} %}
			{% for post_annotation in post_annotations %}
                {{ field }}
				{% if post_annotation.field_id == field %}
                    {% set annotation = post_annotation %}
                    {{ annotation }}
    			{% endif %}
            {% endfor %}
            {{ annotation }}

			<div class="post-annotation field-{{ field }} {{ type }}"><label class="annotation-label">{{ label }}</label>
			{% if type == 'text' %}
				<input type="text" class="post-annotation-input text-{{ field }}" value="{{ annotation.value }}">

			{% elif type == 'textarea' %}
				<textarea class="post-annotation-input textarea-{{ field }}">{{ annotation.value }}</textarea>

			{% elif type == 'dropdown' %}
				<select class="post-annotation-options select-{{ type }}" id="{{ field }}">
				<option class='post-annotation-input' value=''></option>

				{% for option in annotation_fields[field]["options"] %}
					{% set option_id = option.keys() | first %}
					{% set option_label = option.values() | first %}
					<option class="post-annotation-input option-{{ option_id }}" id="option-{{ option_id }}" value="{{ option_label }}" {% if option_label == annotation %}selected{% endif %}>{{ option_label }}</option>
				{% endfor %}
				</select>

			{% elif type == 'checkbox' %}
				<div class='post-annotation-options checkboxes-{{ field }}'>
				{% for option in annotation_fields[field]["options"] %}
					{% set option_id = option.keys() | first %}
					{% set option_label = option.values() | first %}
					{% set checked = "checked" if option_label in annotation.value else "" %}

					<input type='checkbox' class='post-annotation-input option-{{ option_id }}' id='option-{{ post.id }}-{{ option_id }}' value='{{ option_label }}' {{ checked }}><label for='option-{{ post.id }}-{{ option_id }}'>{{ option_label }}</label>
				{% endfor %}
				</div>
			{% endif %}

			</div>
		{% endfor %}
	{% endif %}
</div>